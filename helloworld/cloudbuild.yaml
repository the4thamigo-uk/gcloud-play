steps:
  - name: 'gcr.io/cloud-builders/docker'
    dir: 'helloworld'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/${_SERVICE}:${_VERSION}', '.']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['push', 'gcr.io/$PROJECT_ID/${_SERVICE}:${_VERSION}']
  - name: 'gcr.io/google.com/cloudsdktool/cloud-sdk'
    entrypoint: gcloud
    args: ['run', 'deploy', '${_SERVICE}', '--image', 'gcr.io/$PROJECT_ID/${_SERVICE}:${_VERSION}', '--region', '${_REGION}', '--platform', 'managed']

substitutions:
  _SERVICE: helloworld
  _VERSION: ${TAG_NAME/helloworld\//}

  _REGION: europe-west2
options:
  dynamic_substitutions: true
